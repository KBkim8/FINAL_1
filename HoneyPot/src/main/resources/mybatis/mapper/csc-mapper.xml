<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="csc">

	<!-- FAQ -->

	<select id="getFAQCatList" resultType="com.hp.app.csc.vo.FAQCategoryVo">
		SELECT
			NO
			, NAME
		FROM FAQ_CATEGORY
	</select>
	
	<select id="getFAQList" resultType="com.hp.app.csc.vo.FAQVo">
		SELECT
		    F.NO AS NO
		    , C.NAME AS FAQ_CNAME
		    , F.QUESTION AS QUESTION
		    , A.NAME AS WRITER_NAME
		    , TO_CHAR(F.ENROLL_DATE, 'YY.MM.DD HH:MI') AS ENROLL_DATE
		    , F.HIT AS HIT
		FROM FAQ F
		JOIN FAQ_CATEGORY C ON F.FAQ_CNO = C.NO
		JOIN ADMIN A ON A.NO = F.WRITER_NO
		WHERE STATUS = 'N'
		<if test="searchType != '' and searchType != null">
			AND C.NO = #{searchType}
		</if>
		<if test="searchValue != '' and searchValue != null">
			AND F.QUESTION LIKE ('%' || #{searchValue} || '%')
		</if>
		ORDER BY F.ENROLL_DATE DESC
	</select>
	
	<select id="getFAQByNo" resultType="com.hp.app.csc.vo.FAQVo">
		SELECT
			QUESTION
			, ANSWER
		FROM FAQ
		WHERE NO = #{fno}
		AND STATUS = 'N'
	</select>
	
	<select id="getFAQCnt" resultType="int">
		SELECT COUNT(NO)
		FROM FAQ
		WHERE STATUS = 'N'
		<if test="searchType != '' and searchType != null">
			AND FAQ_CNO = #{searchType}
		</if>
		<if test="searchValue != '' and searchValue != null">
			AND QUESTION LIKE ('%' || #{searchValue} || '%')
		</if>
	</select>
	
	<update id="increaseHit">
		UPDATE FAQ
		SET HIT = HIT + 1
		WHERE NO = #{fno}
	</update>
	
	<!-- 문의 -->
	
	<!-- 문의 카테고리 조회 -->
	<select id="getQNACatList" resultType="com.hp.app.csc.vo.QNACategoryVo">
		SELECT 
			NO
			, NAME
		FROM QNA_CATEGORY
	</select>
	
	<!-- 문의 목록 (화면) -->
	<select id="getQNAList" resultType="com.hp.app.csc.vo.QNAVo">
		SELECT
		    Q.NO AS NO
		    , Q.TITLE AS TITLE
            , C.NAME AS QNA_CNAME
		    , TO_CHAR(Q.ENROLL_DATE, 'YY.MM.DD HH:MI') AS ENROLL_DATE
            , Q.ANSWER_YN
		FROM QNA Q
		JOIN QNA_CATEGORY C ON Q.QNA_CNO = C.NO
		ORDER BY Q.ENROLL_DATE DESC
	
	</select>
	
	<!-- 문의 상세 조회 (화면) -->
	<select id="getQNAByNo" resultType="com.hp.app.csc.vo.QNAVo">
		SELECT 
			Q.NO,
            Q.TITLE,
            Q.CONTENT,
            Q.ANSWER
        FROM QNA Q
        JOIN MEMBER M ON Q.MEMBER_NO = M.NO
        WHERE Q.NO = #{no}
        AND M.NO = #{memberNo}
	</select>
	
	<!-- 문의 등록 -->
	<insert id="insertInquiry">
		INSERT INTO QNA
		(
			NO
			, QNA_CNO
			, MEMBER_NO
			, TITLE
			, CONTENT
		) VALUES(
			SEQ_QNA_NO.NEXTVAL
			, #{qnaCno}
			, #{memberNo}
			, #{title}
			, #{content}
		)
	</insert>
	
	<!-- 문의 내역 삭제 -->
	 <delete id="deleteInquiry">
	 	DELETE FROM QNA
	 	WHERE NO = #{no}
	 	AND MEMBER_NO = #{memberNo}
	 </delete>
	
	
	<!-- 신고 -->
	
	<!-- 신고 카테고리 조회 -->
	<select id="getReportCatList" resultType="com.hp.app.csc.vo.ReportCategoryVo">
		SELECT 
			NO
			, NAME
		FROM REPORT_CATEGORY
	</select>
	
	<!-- 신고 대상 회원 List 조회 -->
	<select id="getMemberList" resultType="com.hp.app.member.vo.MemberVo">
		SELECT
		     NO
		     , NAME
		     , DONG_NUM
		     , HO_NUM
		     , PROFILE
		FROM MEMBER
		WHERE STATUS = 'Y'
		<if test="searchType != null">
		AND ${searchType} = #{searchValue}
		</if>
	</select>
	
	<!-- 신고 대상 회원 조회 -->
	<select id="getMemberByNo" resultType="com.hp.app.member.vo.MemberVo">
		SELECT
			NO
			, NAME
			, PROFILE
		FROM MEMBER
		WHERE STATUS = 'Y'
		AND NO = #{mno}
	</select>
	
	<!-- 신고 등록 -->
	<insert id="insertReport">
		INSERT INTO REPORT 
		(
	        NO
	        ,REPORT_CNO
	        ,REPORTER
	        ,RESPONDENT
	        ,TITLE
	        ,CONTENT
    	) VALUES (
	        SEQ_REPORT_NO.NEXTVAL
	        , #{reportCno}
	        , #{reporter}
	        , #{respondent}
	        , #{title}
	        , #{content}
		)
	</insert>
	
	<!-- 신고 List 조회 -->
	<select id="getReportList" resultType="com.hp.app.csc.vo.ReportVo">
		SELECT
		    R.NO
		    , R.TITLE
		    , TO_CHAR(R.ENROLL_DATE, 'YY.MM.DD HH:MI') AS ENROLL_DATE
		    , C.NAME AS REPORT_CNAME
		    , R.ANSWER_DATE
		FROM REPORT R
		JOIN REPORT_CATEGORY C ON R.REPORT_CNO = C.NO
		WHERE R.REPORTER = #{no}
		ORDER BY R.ENROLL_DATE DESC
	</select>
	
	<!-- 신고 상세 조회 -->
	<select id="getReportByNo" resultType="com.hp.app.csc.vo.ReportVo">
		SELECT
		    R.NO
		    ,R.TITLE
		    ,R.CONTENT
		    ,R.ANSWER_DATE
		    ,M.NAME AS MEMBER_NAME
		    ,M.PROFILE AS MEMBER_PROFILE
		FROM REPORT R
		JOIN MEMBER M ON R.RESPONDENT = M.NO
		WHERE R.NO = #{no}
		AND R.REPORTER = #{reporter}
	</select>
	
	<!-- 신고 내역 삭제 -->
	<delete id="deleteReport">
		DELETE FROM REPORT
		WHERE NO = #{no}
		AND REPORTER = #{reporter}
	</delete>
  
</mapper>