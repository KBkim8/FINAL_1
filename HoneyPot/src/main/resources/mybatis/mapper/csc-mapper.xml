<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="csc">

	<!-- FAQ -->

	<select id="getFAQCatList" resultType="com.hp.app.csc.vo.FAQCategoryVo">
		SELECT
			NO
			, NAME
		FROM FAQ_CATEGORY
	</select>
	
	<select id="getFAQList" resultType="com.hp.app.csc.vo.FAQVo">
		SELECT
		    F.NO AS NO
		    , C.NAME AS FAQ_CNAME
		    , F.QUESTION AS QUESTION
		    , A.NAME AS WRITER_NAME
		    , TO_CHAR(F.ENROLL_DATE, 'YY.MM.DD HH:MI') AS ENROLL_DATE
		    , F.HIT AS HIT
		FROM FAQ F
		JOIN FAQ_CATEGORY C ON F.FAQ_CNO = C.NO
		JOIN ADMIN A ON A.NO = F.WRITER_NO
		WHERE STATUS = 'N'
		ORDER BY F.ENROLL_DATE DESC
	</select>
	
	<select id="getFAQByNo" resultType="com.hp.app.csc.vo.FAQVo">
		SELECT
			QUESTION
			, ANSWER
		FROM FAQ
		WHERE NO = #{fno}
		AND STATUS = 'N'
	</select>
	
	<select id="getFAQCnt" resultType="int">
		SELECT COUNT(NO)
		FROM FAQ
		WHERE STATUS = 'N'
	</select>
	
	<update id="increaseHit">
		UPDATE FAQ
		SET HIT = HIT + 1
		WHERE NO = #{fno}
	</update>
	
	<!-- 문의 -->
	
	<!-- 문의 카테고리 가져오기 -->
	<select id="getQNACatList" resultType="com.hp.app.csc.vo.QNACategoryVo">
		SELECT 
			NO
			, NAME
		FROM QNA_CATEGORY
	</select>
	
	<!-- 문의 목록 (화면) -->
	<select id="getQNAList" resultType="com.hp.app.csc.vo.QNAVo">
		SELECT
		    Q.NO AS NO
		    , Q.TITLE AS TITLE
            , C.NAME AS QNA_CNAME
		    , TO_CHAR(Q.ENROLL_DATE, 'YY.MM.DD HH:MI') AS ENROLL_DATE
            , Q.ANSWER_YN
		FROM QNA Q
		JOIN QNA_CATEGORY C ON Q.QNA_CNO = C.NO
		ORDER BY Q.ENROLL_DATE DESC
	
	</select>
	
	<!-- 문의 상세 조회 (화면) -->
	<select id="getQNAByNo" resultType="com.hp.app.csc.vo.QNAVo">
		SELECT 
            Q.TITLE,
            Q.CONTENT,
            Q.ANSWER
        FROM QNA Q
        JOIN MEMBER M ON Q.MEMBER_NO = M.NO
        WHERE Q.NO = #{no}
        AND M.NO = #{memberNo}
	</select>
	
	<!-- 문의 등록 -->
	<insert id="insertInquiry">
		INSERT INTO QNA
		(
			NO
			, QNA_CNO
			, MEMBER_NO
			, TITLE
			, CONTENT
		) VALUES(
			SEQ_QNA_NO.NEXTVAL
			, #{qnaCno}
			, #{memberNo}
			, #{title}
			, #{content}
		)
	</insert>
  
</mapper>